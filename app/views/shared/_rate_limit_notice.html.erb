<% if request.env['rack.attack.throttle_data'] %>
  <% throttle_data = request.env['rack.attack.throttle_data'] %>
  <% if throttle_data.any? { |_, data| data[:limit] && data[:count] > data[:limit] * 0.8 } %>
    <div class="fixed bottom-4 right-4 max-w-sm shadow-lg z-50">
      <%= render "shared/alert_panel",
          variant: :warning,
          icon: "⚠️",
          title: current_user&.vietnamese? ? "Cảnh báo giới hạn tốc độ" : "속도 제한 경고",
          body: current_user&.vietnamese? ? "Bạn đang gần đạt giới hạn yêu cầu. Vui lòng giảm tốc độ." : "요청 제한에 근접하고 있습니다. 속도를 줄여주세요." %>
    </div>
  <% end %>
<% end %>