<% content_for :title, t('inquiries.dashboard.title') %>

<div class="max-w-2xl mx-auto px-4 py-6">
  <!-- 헤더 -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold text-gray-900"><%= t('inquiries.dashboard.title') %></h1>
    <p class="text-gray-500 text-sm mt-1"><%= t('inquiries.dashboard.subtitle') %></p>
  </div>

  <!-- 상태 필터 탭 -->
  <div class="flex gap-2 mb-6 overflow-x-auto pb-2">
    <%= link_to me_inquiries_path,
        class: "flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors #{@status == 'all' ? 'bg-green-600 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}" do %>
      <%= t('inquiries.dashboard.filter.all') %>
      <span class="<%= @status == 'all' ? 'bg-white/20' : 'bg-gray-200' %> px-2 py-0.5 rounded-full text-xs"><%= @counts[:all] %></span>
    <% end %>

    <%= link_to me_inquiries_path(status: 'pending'),
        class: "flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors #{@status == 'pending' ? 'bg-orange-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}" do %>
      <%= t('inquiries.dashboard.filter.pending') %>
      <% if @counts[:pending] > 0 %>
        <span class="<%= @status == 'pending' ? 'bg-white/20' : 'bg-orange-100 text-orange-600' %> px-2 py-0.5 rounded-full text-xs font-bold"><%= @counts[:pending] %></span>
      <% end %>
    <% end %>

    <%= link_to me_inquiries_path(status: 'read'),
        class: "flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors #{@status == 'read' ? 'bg-blue-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}" do %>
      <%= t('inquiries.dashboard.filter.read') %>
      <span class="<%= @status == 'read' ? 'bg-white/20' : 'bg-gray-200' %> px-2 py-0.5 rounded-full text-xs"><%= @counts[:read] %></span>
    <% end %>

    <%= link_to me_inquiries_path(status: 'replied'),
        class: "flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-colors #{@status == 'replied' ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'}" do %>
      <%= t('inquiries.dashboard.filter.replied') %>
      <span class="<%= @status == 'replied' ? 'bg-white/20' : 'bg-gray-200' %> px-2 py-0.5 rounded-full text-xs"><%= @counts[:replied] %></span>
    <% end %>
  </div>

  <!-- 문의 목록 -->
  <% if @inquiries.any? %>
    <div class="space-y-4">
      <% @inquiries.each do |inquiry| %>
        <%= link_to me_inquiry_path(inquiry), class: "block" do %>
          <div class="bg-white rounded-xl border <%= inquiry.pending? ? 'border-orange-200 bg-orange-50/50' : 'border-gray-200' %> p-4 hover:shadow-md transition-shadow">
            <!-- 상단: 보낸 사람 + 시간 -->
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <% if inquiry.pending? %>
                  <span class="w-2 h-2 bg-orange-500 rounded-full"></span>
                <% end %>
                <span class="font-medium text-gray-900"><%= inquiry.sender_name %></span>
                <span class="text-xs px-2 py-0.5 rounded-full <%= status_badge_class(inquiry.status) %>">
                  <%= t("inquiries.dashboard.status.#{inquiry.status}") %>
                </span>
              </div>
              <span class="text-xs text-gray-400"><%= time_ago_in_words(inquiry.created_at) %> <%= t('inquiries.dashboard.ago') %></span>
            </div>

            <!-- 게시글 정보 (있는 경우) -->
            <% if inquiry.post %>
              <div class="text-xs text-gray-500 mb-2 flex items-center gap-1">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="truncate"><%= inquiry.post.title %></span>
              </div>
            <% end %>

            <!-- 메시지 미리보기 -->
            <p class="text-gray-600 text-sm line-clamp-2"><%= inquiry.message %></p>

            <!-- 연락처 정보 -->
            <div class="mt-3 flex items-center gap-2 text-xs text-gray-500">
              <span class="px-2 py-1 bg-gray-100 rounded-full"><%= t("inquiries.contact_methods.#{inquiry.contact_method}") %></span>
              <span><%= inquiry.contact_value %></span>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  <% else %>
    <!-- 빈 상태 -->
    <div class="text-center py-16">
      <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
        </svg>
      </div>
      <h3 class="text-gray-900 font-medium mb-1"><%= t('inquiries.dashboard.empty.title') %></h3>
      <p class="text-gray-500 text-sm"><%= t('inquiries.dashboard.empty.description') %></p>
    </div>
  <% end %>
</div>
