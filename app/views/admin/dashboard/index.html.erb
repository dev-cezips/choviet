<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Chợ Việt Admin Dashboard</h1>
    <div class="flex gap-4">
      <%= link_to admin_reports_path, class: "px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700" do %>
        <span class="font-medium">Reports</span>
        <% if @stats[:pending_reports] > 0 %>
          <span class="ml-2 bg-white text-red-600 px-2 py-0.5 rounded-full text-xs font-bold">
            <%= @stats[:pending_reports] %>
          </span>
        <% end %>
      <% end %>
    </div>
  </div>
  
  <!-- Key Metrics Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Total Users -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Total Users</h3>
      <p class="mt-2 text-3xl font-bold text-gray-900"><%= @stats[:total_users] %></p>
      <p class="mt-1 text-sm text-green-600">+<%= @stats[:new_users_today] %> today</p>
    </div>
    
    <!-- Active Posts -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Active Posts</h3>
      <p class="mt-2 text-3xl font-bold text-gray-900"><%= @stats[:active_posts] %></p>
      <p class="mt-1 text-sm text-blue-600">+<%= @stats[:posts_today] %> today</p>
    </div>
    
    <!-- Messages Today -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Messages Today</h3>
      <p class="mt-2 text-3xl font-bold text-gray-900"><%= @stats[:messages_today] %></p>
      <p class="mt-1 text-sm text-purple-600"><%= @stats[:total_messages] %> total</p>
    </div>
    
    <!-- Translations -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider">Translations Today</h3>
      <p class="mt-2 text-3xl font-bold text-gray-900"><%= @stats[:translations_today] %></p>
      <p class="mt-1 text-sm text-orange-600"><%= @stats[:teencode_translations] %> with teencode</p>
    </div>
  </div>

  <!-- User Activity & Trust -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Weekly Active Users -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">User Activity</h3>
      <div class="space-y-3">
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Active Today</span>
          <span class="font-semibold text-gray-900"><%= @stats[:active_users_today] %> users</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Active This Week</span>
          <span class="font-semibold text-gray-900"><%= @stats[:active_users_week] %> users</span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">New Users This Week</span>
          <span class="font-semibold text-gray-900"><%= @stats[:new_users_this_week] %></span>
        </div>
      </div>
    </div>
    
    <!-- Trust & Safety -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Trust & Safety</h3>
      <div class="space-y-3">
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Total Reports</span>
          <span class="font-semibold text-gray-900"><%= @stats[:total_reports] %></span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Pending Review</span>
          <span class="font-semibold text-red-600"><%= @stats[:pending_reports] %></span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-gray-600">Chat Rooms</span>
          <span class="font-semibold text-gray-900"><%= @stats[:total_chat_rooms] %></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Event Breakdown -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Today's Events -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Today's Events</h3>
      <div class="space-y-2">
        <% @stats[:event_counts_today].each do |event_type, count| %>
          <div class="flex justify-between items-center">
            <span class="text-gray-600"><%= event_type.humanize %></span>
            <span class="font-medium text-gray-900"><%= count %></span>
          </div>
        <% end %>
      </div>
    </div>
    
    <!-- Device Breakdown -->
    <div class="bg-white rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Device Usage (Week)</h3>
      <div class="space-y-2">
        <% @stats[:device_breakdown].each do |device, count| %>
          <div class="flex justify-between items-center">
            <span class="text-gray-600 capitalize"><%= device || 'Unknown' %></span>
            <span class="font-medium text-gray-900"><%= count %></span>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Recent Events -->
  <div class="bg-white rounded-lg shadow p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Events (Live Feed)</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead>
          <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Device</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          <% @recent_events.each do |event| %>
            <tr>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                <%= event.created_at.strftime("%H:%M:%S") %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900">
                <%= event.event_type.humanize %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                <%= event.user&.display_name || 'Guest' %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-600">
                <%= event.device.capitalize %>
              </td>
              <td class="px-4 py-3 text-sm text-gray-600">
                <%= truncate(event.properties.to_json, length: 50) %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>