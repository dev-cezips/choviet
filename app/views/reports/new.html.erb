<% if turbo_native_app? %>
  <!-- Turbo Native: Pure HTML form -->
  <div class="bg-white min-h-screen p-6 pb-24">
    <div class="max-w-md mx-auto">
      <h2 class="text-xl font-bold text-red-600 mb-4">
        <%= t('reports.title', default: 'üö® B√°o c√°o vi ph·∫°m') %>
      </h2>

      <%= render "shared/form_errors", object: @report, class_name: "mb-4" %>

      <form action="<%= polymorphic_path([@reportable, @report]) %>" method="post" accept-charset="UTF-8">
        <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">

        <div class="mb-4">
          <p class="text-sm text-gray-600 mb-3">
            <% if @reportable.is_a?(Post) %>
              B·∫°n ƒëang b√°o c√°o b√†i vi·∫øt: <strong><%= @reportable.title %></strong>
            <% end %>
          </p>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            L√Ω do b√°o c√°o <span class="text-red-500">*</span>
          </label>
          <div class="space-y-2">
            <label class="flex items-center p-3 border rounded-md">
              <input type="radio" name="report[reason_code]" value="spam" class="mr-3">
              <span>üö´ Spam / Qu·∫£ng c√°o</span>
            </label>
            <label class="flex items-center p-3 border rounded-md">
              <input type="radio" name="report[reason_code]" value="abusive" class="mr-3">
              <span>ü§¨ Ng√¥n t·ª´ ƒë·∫£ k√≠ch</span>
            </label>
            <label class="flex items-center p-3 border rounded-md">
              <input type="radio" name="report[reason_code]" value="scam" class="mr-3">
              <span>ü¶ä L·ª´a ƒë·∫£o</span>
            </label>
            <label class="flex items-center p-3 border rounded-md">
              <input type="radio" name="report[reason_code]" value="inappropriate" class="mr-3">
              <span>üîû N·ªôi dung kh√¥ng ph√π h·ª£p</span>
            </label>
          </div>
        </div>

        <div class="mb-6">
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Chi ti·∫øt th√™m (t√πy ch·ªçn)
          </label>
          <textarea name="report[description]" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="M√¥ t·∫£ th√™m v·ªÅ vi ph·∫°m..."></textarea>
        </div>

        <div class="flex gap-3">
          <input type="submit" value="G·ª≠i b√°o c√°o" class="flex-1 bg-red-600 text-white py-3 px-4 rounded-md font-medium">
          <a href="javascript:history.back()" class="flex-1 bg-gray-200 text-gray-700 py-3 px-4 rounded-md font-medium text-center">H·ªßy</a>
        </div>
      </form>
    </div>
  </div>
<% else %>
  <!-- Web: Modal with backdrop -->
  <%= turbo_frame_tag "modal" do %>
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
         data-controller="modal-backdrop"
         data-action="click->modal-backdrop#closeOnBackdrop">
      <div class="bg-white rounded-lg p-6 m-4 max-w-md w-full max-h-[75vh] overflow-y-auto" data-modal-backdrop-target="content">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-red-600">
            <%= t('reports.title', default: 'üö® B√°o c√°o vi ph·∫°m') %>
          </h2>
          <button type="button"
                  data-action="click->modal-backdrop#close"
                  class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <%= form_with model: [@reportable, @report], data: { turbo_frame: "modal" } do |form| %>
          <%= render "shared/form_errors", object: @report, class_name: "mb-4" %>

          <div class="mb-4">
            <p class="text-sm text-gray-600 mb-3">
              <% if @reportable.is_a?(Post) %>
                <%= t('reports.reporting_post', default: 'B·∫°n ƒëang b√°o c√°o b√†i vi·∫øt n√†y') %>
              <% elsif @reportable.is_a?(User) %>
                <%= t('reports.reporting_user', default: 'B·∫°n ƒëang b√°o c√°o ng∆∞·ªùi d√πng n√†y') %>
              <% elsif @reportable.is_a?(ConversationMessage) %>
                <%= t('reports.reporting_message', default: 'B·∫°n ƒëang b√°o c√°o tin nh·∫Øn n√†y') %>
              <% elsif @reportable.is_a?(Message) %>
                <%= t('reports.reporting_message', default: 'B·∫°n ƒëang b√°o c√°o tin nh·∫Øn n√†y') %>
              <% end %>
            </p>

            <div class="bg-gray-50 rounded-md p-3">
              <% if @reportable.is_a?(Post) %>
                <p class="font-medium text-gray-800"><%= @reportable.title %></p>
                <p class="text-sm text-gray-600 mt-1">
                  <%= t('reports.by_user', default: 'b·ªüi') %> <%= @reportable.user.display_name %>
                </p>
              <% elsif @reportable.is_a?(User) %>
                <p class="font-medium text-gray-800"><%= @reportable.display_name %></p>
                <p class="text-sm text-gray-600"><%= @reportable.email %></p>
              <% elsif @reportable.is_a?(ConversationMessage) %>
                <p class="font-medium text-gray-800"><%= truncate(@reportable.body, length: 100) %></p>
                <p class="text-sm text-gray-600 mt-1">
                  <%= t('reports.by_user', default: 'b·ªüi') %> <%= @reportable.user.display_name %>
                </p>
              <% elsif @reportable.is_a?(Message) %>
                <p class="font-medium text-gray-800"><%= truncate(@reportable.content_raw, length: 100) %></p>
                <p class="text-sm text-gray-600 mt-1">
                  <%= t('reports.by_user', default: 'b·ªüi') %> <%= @reportable.sender.display_name %>
                </p>
              <% end %>
            </div>
          </div>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <%= t('reports.reason', default: 'L√Ω do b√°o c√°o') %> <span class="text-red-500">*</span>
            </label>
            <div class="space-y-2">
              <% Report.reason_options_for_select(current_user&.locale || :vi).each do |option| %>
                <label class="flex items-start p-3 border rounded-md hover:bg-gray-50 cursor-pointer">
                  <%= form.radio_button :reason_code, option[1], class: "mt-1 mr-3" %>
                  <span class="flex-1"><%= option[0] %></span>
                </label>
              <% end %>
            </div>
          </div>

          <div class="mb-6">
            <label for="report_description" class="block text-sm font-medium text-gray-700 mb-2">
              <%= t('reports.description', default: 'Chi ti·∫øt th√™m (t√πy ch·ªçn)') %>
            </label>
            <%= form.text_area :description, rows: 3,
                class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",
                placeholder: t('reports.description_placeholder', default: 'M√¥ t·∫£ th√™m v·ªÅ vi ph·∫°m...') %>
          </div>

          <% notice_items = [
            "‚Ä¢ " + t('reports.notice.false_report', default: 'B√°o c√°o sai c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn uy t√≠n c·ªßa b·∫°n'),
            "‚Ä¢ " + t('reports.notice.review', default: 'Ch√∫ng t√¥i s·∫Ω xem x√©t trong 24h'),
            "‚Ä¢ " + t('reports.notice.auto_hide', default: 'N·ªôi dung c√≥ 3 b√°o c√°o s·∫Ω t·ª± ƒë·ªông ·∫©n')
          ] %>
          <%= render "shared/alert_panel",
              variant: :warning,
              icon: "üì¢",
              title: t('reports.notice.title', default: 'L∆∞u √Ω:'),
              items: notice_items,
              class_name: "mb-6" %>

          <div class="flex gap-3">
            <%= form.submit t('reports.submit', default: 'G·ª≠i b√°o c√°o'),
                class: "flex-1 bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 font-medium",
                data: { disable_with: t('reports.submitting', default: 'ƒêang g·ª≠i...') } %>
            <button type="button"
                    data-action="click->modal-backdrop#close"
                    class="flex-1 bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 font-medium">
              <%= t('reports.cancel', default: 'H·ªßy') %>
            </button>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
<% end %>
